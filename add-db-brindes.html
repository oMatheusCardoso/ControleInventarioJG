<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
    <title>Brindes</title>
  
  </head>

  <div id="logo">
    <a id="logo" href="home.html"><img src="logo.png" alt="Logo Jovens GÃªnios" ></a>
  </div>

  <link rel="stylesheet" href="./css/css-global.css"/>
  <link rel="stylesheet" href="./css/brindes.css"/>


  <body>
    <button type="button" class="solid" id="sair">Sair</button>
    <a href="home.html"><button type="button" class="solid" id="backToHome">Voltar</button></a>
    <a href="add-db-brindes.html"><button type="button" class="solid" id="AddBrindes">Adicionar </button></a>
    <h3>Controle de Brindes</h3> 

    <h4>Insira o nome do Item</h4>
    <input id="findID" type="text" />
    <button id="find" class="solid">Procurar</button>

    <div id="dadosItens">

    <h1>Dados dos Itens</h1>
    <h3>Adicionar ao Estoque</h3>

    <form id="FormUpdate">
      <div>
        <label>Item: </label>
        <br>
        <input type="text" required name="Item" id="Item">
      </div> 
      <div>
        <label>Tipo: </label>
        <br>
        <input type="text" required name="Tipo" id="Tipo">
      </div> 
      <div>
        <label>Material: </label>
        <br>
        <input type="text" required name="Material" id="Material">
      </div> 
      <div>
        <label>Arte: </label>
        <br>
        <input type="text" required name="Arte" id="Arte">
      </div> 
      <div>
        <label>Data da Compra: </label>
        <br>
        <input type="date"required name="DataCompra" id="DataCompra">
      </div> 
      <div>
        <label>Obs: </label>
        <br>
        <input type="text" name="Obs" id="Obs">
      </div> 
      <div>
        <label>Imagem da Nota Fiscal: </label>
        <br>
        <input type="file" name="uploadNotaFiscal" required id="uploadNotaFiscal">
      </div> 
      <div>
        <label>Imagem do Item: </label>
        <br>
        <input type="file" required name="uploadImagem" id="uploadImagem">
      </div> 
      
      <input type="submit" id="enviarUpload">

    </form>

    <h3 id="Item" type="text"></h3>
    <img id="Imagem" src="" alt="Imagem do Item"> 
    <h3 id="Tipo" type="text"></h3>
    <h3 id="Material" type="text"></h3>
    <h3 id="Arte" type="text"></h3>
    <h3 id="Quantidade" type="text"></h3>
    <h3 id="DataCompra" type="text"></h3>
    <a id= "VisuNota" target="_blank" href=""><button>Visualizar Nota Fiscal</button></a>
    <h3 id="Obs" type="text"></h3>
    
    </div>

    <script src="scan.js"></script>

    <script type="module" async>
      import {
        auth,
        onAuthStateChanged,
        dbref,
        FindData,
        getStorage,
        refStorage,
        storage,
        storageRef,
        uploadBytes,
      } from "./libs/firebase/index.js";

      import { 
        getMonths,
        calc,
        formatCurrency,
      } from "./utils/calcDepreciation.js";

      function redirectUser() {
        onAuthStateChanged(auth, (user) => {
          if (user) {
            console.log(user);
          } else {
            logout();
          }
        });
      }
      // redirectUser();  //DESATIVADO PARA MELHOR TESTE

      var Tipo = document.querySelector("#Tipo");
      var Material = document.querySelector("#Material");
      var Arte = document.querySelector("#Arte");
      var Quantidade = document.querySelector("#Quantidade");
      var DataCompra = document.querySelector("#Item");
      var VisuNota = document.querySelector("#Modelo");
      var Obs = document.querySelector("#Obs");
      var find = document.querySelector("#find");
      var DataCompra = document.querySelector("#DataCompra");
      var Imagem = document.querySelector("#Imagem");
      var uploadNotaFiscal = document.querySelector("#uploadNotaFiscal");
      var uploadImagem = document.querySelector("#uploadImagem");
      var enviarUpload = document.querySelector("#enviarUpload")
      var FormUpdate = document.querySelector("#FormUpdate");
      
      function setData(item) {
      

        getMonths(item.DataCompra);
        calc(item.ValorCompra, item.DataCompra);

        Tipo.innerHTML = "Tipo: " + item.Tipo;
        Imagem.innerHTML = "Imagem: " + item.Imagem;        
        Material.innerHTML = "Material: " + item.Material;
        Arte.innerHTML = "Arte: " + item.Arte;
        Quantidade.innerHTML = "Quantidade: " + item.Quantidade;
        DataCompra.innerHTML = "DataCompra: " + item.DataCompra;
        // VisuNota.innerHTML ="VisuNota: " + item.VisuNota;
        Obs.innerHTML = "Obs: " + item.Obs;
        // VisuNota.setAttribute("href", item.NotaFiscal);
        Imagem.setAttribute ("src", item.Imagem);

        console.log(Imagem);

        if ((VisuNota || Imagem ) != null) {
          
            Imagem.style.display="flex";
            // VisuNota.style.display="flex";

        };

      //   if (Imagem != null) {
          
          
      //     Imagem.style.display="flex";

      // };
      }
      
      // uploadImagem.addEventListener("change", (event) =>{
      //   console.log(event.target.files);
      // });
      FormUpdate.addEventListener("submit", (event) =>{

      event.preventDefault();

      const notaFiscalfile = uploadNotaFiscal.files?.[0];
      console.log(notaFiscalfile);
      const uploadNotaFiscalRef = refStorage(storage, `Brindes/NotaFiscal/${notaFiscalfile.name}`);

      uploadBytes(uploadNotaFiscalRef, notaFiscalfile).then((snapshot) =>{

        uploadNotaFiscalRef.getDownloadURL();
        console.log(getDownloadURL);
        console.log("Upload com sucesso!");

        
      });

      const imagemBrindeFile = uploadImagem.files?.[0];
      console.log(imagemBrindeFile);
      const uploadImagemRef = refStorage(storage, `Brindes/ImagemBrindes/${imagemBrindeFile.name}`);

      uploadBytes(uploadImagemRef, imagemBrindeFile).then((snapshot) =>{
        console.log("Upload com sucesso!");
        alert("Upload com sucesso!");
      });
      
      
        
      })

      // enviarUpload.addEventListener("click", (event) => {
      // // event.preventDefault();
      // const notaFiscalfile = uploadNotaFiscal.files?.[0];
      //   console.log(notaFiscalfile);

      // const uploadNotaFiscalRef = refStorage(storage, 'Brindes/NotaFiscal/nomeNotaFiscal.jpg');

      // uploadBytes(uploadNotaFiscalRef, uploadNotaFiscal).then((snapshot) =>{
      //   console.log("Upload com sucesso!");
      // });

      // var nomeImagem = "Brindes1";

      // const uploadImagemRef = refStorage(storage, 'Brindes/ImagemBrindes/nomeImagem.jpg');

      // uploadBytes(uploadImagemRef, uploadImagem).then((snapshot) =>{
      //   console.log("Upload com sucesso!");
      // });

      // });


      find.addEventListener("click", async () => {
        const item = await FindData(findID.value, "Brindes");
        setData(item);
        
      });

      
      
      function logout() {
      auth.signOut().then(() => {
          window.location.href = "index.html";
      }).catch(() => {
          alert('Erro ao fazer logout!')
    });
}

      
      sair.addEventListener("click", logout);
    </script>
  </body>
</html>