<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
    <title>Brindes</title>
  
  </head>

  <link rel="stylesheet" href="./css/css-global.css"/>
  <link rel="stylesheet" href="./css/brindes.css"/>


  <body>
    <header>
    <a href="home.html"><img id="ConteudoLogo" src="logo.png" alt="Logo Jovens GÃªnios" ></a>
    </header>

    <main>
      
      <h3 class="text_page">Controle de Brindes</h3> 
      <h4 class="text_page">Insira o nome do Item</h4>
      <input id="findID" type="text" />
      <br>
      <button id="find" class="solid">Procurar</button>
  
      <h1 id="lista_itens" style="display: none">Lista dos Itens</h1>
    
    
    <div id="dadosItens">
    <Ol id="ListaItem"></Ol>
    </div>
  
    </main>

    <footer>
      <div id="Buttons"> 
        <a class="solid" id="sair"><ion-icon name="exit" size="large"></ion-icon></a>
        <a href="add-db-brindes.html"><ion-icon name="add-circle" size="large"></ion-icon></a>
        <a href="home.html"><ion-icon name="arrow-back" size="large"></ion-icon></a>
      </div>
    </footer>

    </div>
    <script
    type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"
    ></script>
    <script src="js/brindes.js"></script>
    <script type="module" async>
      import {
        auth,
        onAuthStateChanged,
        dbref,
        FindDataByType,
        orderByChild,
        addHistoryData
      } from "./libs/firebase/index.js";

      import { 
        getMonths,
        calc,
        formatCurrency,
      } from "./utils/calcDepreciation.js";

      function redirectUser() {
        onAuthStateChanged(auth, (user) => {
          if (user) {
          } else {
            logout();
          }
        });
      }
      redirectUser();  

      var Tipo = document.querySelector("#Tipo");
      var Material = document.querySelector("#Material");
      var Arte = document.querySelector("#Arte");
      var Quantidade = document.querySelector("#Quantidade");
      var DataCompra = document.querySelector("#DataCompra");
      var ImagemNotaFiscal = document.querySelector("#ImagemNotaFiscal");
      var Obs = document.querySelector("#Obs");
      var find = document.querySelector("#find");
      var DataCompra = document.querySelector("#DataCompra");
      var Imagem = document.querySelector("#Imagem");	
      var PrecoCompra = document.querySelector("#PrecoCompra");	
      var CustoProduto = document.querySelector("#CustoProduto");	
      var PrecoVenda = document.querySelector("#PrecoVenda");	
      var ListaItem =  document.getElementById("ListaItem");
      var lista_itens = document.getElementById("lista_itens");


      function setData(item){
      
        let transactions = item;
        async function Listagem(transactions) {

          ListaItem.innerHTML = "";
          
          for(let transaction in transactions) {

            
            let value = transactions[transaction];
            let li = document.createElement('li');
            li.classList.add(value.Tipo);          

            let ImagemDB = document.createElement('img')
            ImagemDB.setAttribute ("src", value.Imagem)
            li.appendChild(ImagemDB);
            
            let ItemDB = document.createElement('p')
            ItemDB.innerHTML = "<b> Item: </b>" + value.Item
            li.appendChild(ItemDB);

            let TipoDB = document.createElement('p')
            TipoDB.innerHTML = "<b> Tipo: </b>"+ value.Tipo;
            li.appendChild(TipoDB);
          
            let QuantidadeDB = document.createElement('p')
            QuantidadeDB.innerHTML = "<b> Quantidade: </b> "+ value.Quantidade;
            li.appendChild(QuantidadeDB);

            let aEntrada = document.createElement('a')
            aEntrada.setAttribute("id", `${value.Item}`.replace(/\s/g, ''))
            aEntrada.setAttribute("href", "entrada-brindes.html"+ "?id="+value.Item)
            aEntrada.innerText = "Adicionar";
            li.appendChild(aEntrada);  

            let aEdit = document.createElement('a')
            aEdit.setAttribute("id", `${value.Item}`.replace(/\s/g, ''))
            aEdit.setAttribute("href", "baixa-brindes.html"+ "?id="+value.Item)
            aEdit.innerText = "Retirar";
            li.appendChild(aEdit);  

            ListaItem.appendChild(li);       
            

          };
        }

          Listagem(transactions);
        
      }

      find.addEventListener("click", async () => {
        
        if(findID.value == ""){
          alert("Campo de pesquisa vazio")
        } else{
          await FindDataByType(findID.value, "Brindes", setData);
          lista_itens.setAttribute("style", "display: flex")
        } 

        
      });    
      
      function logout() {
      auth.signOut().then(() => {
          window.location.href = "index.html";
      }).catch(() => {
          alert('Erro ao fazer logout!')
    });
}

      
      sair.addEventListener("click", logout);

      
    </script>
</body>
</html>
